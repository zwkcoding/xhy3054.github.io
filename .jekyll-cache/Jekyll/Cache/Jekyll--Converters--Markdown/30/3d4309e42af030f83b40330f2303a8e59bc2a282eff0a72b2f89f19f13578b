I"{<p>单目相机无法恢复真实尺度，使得双目相机成为了很多开发者的选择。</p>

<h1 id="双目相机模型">双目相机模型</h1>

<p>双目恢复深度进行三维重建的原理与人眼类似，为了进一步分析双目测距的原理，可以从下图深入理解双目相机模型：</p>

<div style="text-align: center">
<img src="/assets/img/stereo/stereo.PNG" width="750" height="450" />
</div>

<p>双目相机一般由左眼和右眼两个<strong>水平放置</strong>的相机组成。上图中左右两个相机都是使用针孔相机模型，两个相机的成像平面在同一个水平面上，同时两个相机光心是水平放置的，因此对于一个P点，其在两个图像上的投影点的行坐标是相同的，我们通过对其纵坐标的处理便可以得到视差了。</p>

<p>图中两个相机光心之间的距离b被成为双目相机的<strong>基线</strong>，是与焦距f一样重要的参数。</p>

<p>根据上图，假设一个空间点P，在左右目各成一像$P_L$与$P_R$，分别以两个光心垂直的位置为二维坐标原点，则$P_L$的横坐标为$u_L$，$P_R$的横坐标为$u_R$，可以发现$u_R$是一个负数。根据上图中右侧三角形相似的原理，可以得到下面公式</p>

<script type="math/tex; mode=display">\frac{z-f}{z}=\frac{b-u_{L}+u_{R}}{b}</script>

<p>经过整理，可以得到</p>

<script type="math/tex; mode=display">z = \frac{fb}{d}, d= u_L -u_R</script>

<p>此处d为投影点在左右图上的横坐标之差，也叫作<strong>视差</strong>，因此，根据视差我们就可以估计出这个空间点的深度了。此处可以发现，视差最小也就是1个像素，因此双目可以测量的最大深度是有上限的，而这个值和$fb$有关，所以一般相机焦距f确定的时候，双目基线越大，可测量的最远深度也越大。</p>

<blockquote>
  <p>由于以上双目相机模型的特殊，我们不仅可以方便的估计深度，也可以在双目匹配时很容易的进行极线（横坐标一致的水平线）搜索匹配，大大减小匹配计算量。</p>
</blockquote>

<h2 id="双目立体标定">双目立体标定</h2>

<p>上面讲述了双目相机模型的原理，我们可以发现这是一个很苛刻的条件，要求两个相机光心在同一水平线上，并且成像平面平行。这个在双目相机的制作中很难做到。因此在获得一个双目相机后，需要对其进行双目标定，得到两个$3*4$的投影矩阵H1和H2，在两个相机成像分别使用这两个矩阵进行投影后得到两个新的矫正后的图像，此时校正后的两个图像应该是满足上面的双目相机模型的。整个矫正过程如下所示</p>

<div style="text-align: center">
<img src="/assets/img/stereo/stereo_rectify.gif" />
</div>

<blockquote>
  <p>对于一个已经标定的双目相机（已知内参、畸变参数等），在opencv中可以使用<code class="highlighter-rouge">cv:StereoRectify</code>来完成双目矫正矩阵的获得（不只是矫正矩阵，还有两个相机之间的位姿变换，视差到深度的4*4映射矩阵等）；对于一个没有标定的双目相机，可以使用opencv中<code class="highlighter-rouge">cv::stereoRectifyUncalibrated</code>函数来获得双目的矫正矩阵；推荐使用第一个函数，其还支持针孔、鱼眼等多种相机模型。</p>
</blockquote>

<h1 id="参考文献">参考文献</h1>
<ul>
  <li>[1]. 视觉slam十四讲</li>
  <li>[2]. https://blog.csdn.net/jaccen/article/details/51217936</li>
  <li>[3]. https://docs.opencv.org/4.2.0/d9/d0c/group__calib3d.html#gaadc5b14471ddc004939471339294f052</li>
</ul>
:ET